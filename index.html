<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Context Engineering for AI Support</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<style>
  :root{--bg:#fff;--text:#0f172a;--muted:#475569}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:14px/1.4 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  header{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid #e2e8f0;background:#fff}
  .muted{color:var(--muted)}
  .wrap{padding:16px}
  button{border:1px solid #e2e8f0;background:#f8fafc;padding:6px 10px;border-radius:8px;cursor:pointer}
  .mermaid svg{width:100% !important; height:auto !important;}
</style>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({ startOnLoad: true, theme: "base", themeVariables: {
    primaryColor: "#ffffff", primaryBorderColor:"#cbd5e1", primaryTextColor:"#0f172a",
    lineColor:"#334155", fontSize:"14px", fontFamily:"ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial"
  }});
  function exportSVG() {
    const svg = document.querySelector(".mermaid svg");
    const blob = new Blob([new XMLSerializer().serializeToString(svg)], {type:"image/svg+xml"});
    const url = URL.createObjectURL(blob); const a = Object.assign(document.createElement("a"), {href:url, download:"diagram.svg"}); a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000);
  }
</script>
</head>
<body>
<header>
  <div><b>Context Engineering for AI Support</b> <span class="muted">Real-time, governed, enterprise-scale</span></div>
  <div>
    <button onclick="exportSVG()">Export SVG</button>
  </div>
</header>

<div class="wrap">
<div class="mermaid">
flowchart LR
  %% ====== PANELS ======
  subgraph CLIENT[Client]
    APP["User / Channels<br/><span class='muted'>Web, Mobile, WhatsApp</span>"]
    HITL["Human Agent Desk<br/><span class='muted'>Context handoff</span>"]
  end

  subgraph ORCH[Orchestration]
    API["API Gateway<br/><span class='muted'>Auth, Rate-limit</span>"]
    POLICY["Policy Store<br/><span class='muted'>Rules, versions</span>"]
    GUARD["Input Guardrails<br/><span class='muted'>PII, Safety, Policies</span>"]
    ORCH["Agent Orchestrator<br/><span class='muted'>Routing, Tools, Memory</span>"]
    RETR["Retriever<br/><span class='muted'>Top-k, Filters</span>"]
    LLM["LLM Service<br/><span class='muted'>Generation, Tools</span>"]
    OG["Output Guardrails<br/><span class='muted'>Toxicity, PII, Policy</span>"]
    MEM["Session Memory<br/><span class='muted'>User & thread state</span>"]
    CACHE["Context/Response Cache (KV)<br/><span class='muted'>Prompt & ctx hits</span>"]
  end

  subgraph DATA[Data Plane]
    VDB["Vector DB<br/><span class='muted'>Embeddings, HNSW</span>"]
    KB["Knowledge Store<br/><span class='muted'>Docs, Policies</span>"]
    DL["Data Lake<br/><span class='muted'>Logs, Images, JSON</span>"]
    RANK["Re-ranker<br/><span class='muted'>Cross-encoder</span>"]
    EMB["Embedding Service<br/><span class='muted'>Batch/Stream</span>"]
    ING["Ingestion & Connectors<br/><span class='muted'>ETL, Webhooks, SaaS</span>"]
    RBAC["Tenant/RBAC Filter<br/><span class='muted'>ACL, tags, recency</span>"]
    INDEXER["Index Manager<br/><span class='muted'>Reindex, TTL, shards</span>"]
    CATALOG["Metadata Catalog<br/><span class='muted'>IDs, versions, lineage</span>"]
  end

  subgraph OBS[Observability]
    MON["Telemetry<br/><span class='muted'>Traces, Metrics</span>"]
    AUD["Audit & Governance<br/><span class='muted'>Prompts, Outputs</span>"]
    EVAL["Eval & Test Harness<br/><span class='muted'>Golden sets, regression</span>"]
  end

  %% ====== FLOWS ======
  APP -- request --> API
  API -- trace --> MON
  API -- escalate --> HITL

  POLICY -- policies --> GUARD
  POLICY -- policies --> OG

  API -- sanitize --> GUARD
  GUARD -- route --> ORCH

  ORCH -- read --> CACHE
  OG -- write --> CACHE

  ORCH -- retrieve --> RETR
  RETR -- pre-filter --> RBAC
  RBAC -- search --> VDB
  VDB -- hits --> RETR
  RETR -- lookup --> KB
  RETR -- re-rank --> RANK
  RANK -- ranked ctx --> ORCH

  ORCH -- tools+prompt --> LLM
  LLM -- filter --> OG
  OG -- respond --> API

  ORCH -- update --> MEM
  MEM -- recall --> ORCH
  ORCH -- handoff packet --> HITL
  HITL -- corrections --> ING
  HITL -- decisions --> AUD

  ING -- land --> DL
  ING -- docs --> KB
  ING -- chunk+embed --> EMB
  EMB -- index --> VDB
  INDEXER -- manage TTL/shards --> VDB
  ING -- register --> CATALOG
  CATALOG -- ACLs --> RBAC

  ORCH -- log --> AUD
  LLM -- store --> AUD
  RETR -- store --> AUD
  AUD -- samples --> EVAL
  EVAL -- tune --> POLICY
  EVAL -- prompt tests --> ORCH
  AUD -- feedback --> DL
  VDB -- ingest --> DL
</div>
</div>

</body>
</html>
